<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Daily Work - Nagios SNMP traps, Vyatta, JasonAntman.com upgrades - Jason Antman's Blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://blog.jasonantman.com/2009/06/daily-work-nagios-snmp-traps-vyatta-jasonantmancom-upgrades/">

        <meta name="author" content="admin" />
        <meta name="keywords" content="apc,bluesocket,Nagios,snmp,vyatta" />
        <meta name="description" content="So it’s been a very busy day. I was up until 5 AM or so working on implementing Puppet at home. I’m building two new boxes - a storage (centralized home directory)/syslog (to MySQL) server and a second web server (possibly also to handle Nagios) - and I decided …" />

        <meta property="og:site_name" content="Jason Antman's Blog" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Daily Work - Nagios SNMP traps, Vyatta, JasonAntman.com upgrades"/>
        <meta property="og:url" content="http://blog.jasonantman.com/2009/06/daily-work-nagios-snmp-traps-vyatta-jasonantmancom-upgrades/"/>
        <meta property="og:description" content="So it’s been a very busy day. I was up until 5 AM or so working on implementing Puppet at home. I’m building two new boxes - a storage (centralized home directory)/syslog (to MySQL) server and a second web server (possibly also to handle Nagios) - and I decided …"/>
        <meta property="article:published_time" content="2009-06-27" />
            <meta property="article:section" content="Miscellaneous" />
            <meta property="article:tag" content="apc" />
            <meta property="article:tag" content="bluesocket" />
            <meta property="article:tag" content="Nagios" />
            <meta property="article:tag" content="snmp" />
            <meta property="article:tag" content="vyatta" />
            <meta property="article:author" content="admin" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.jasonantman.com/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="http://blog.jasonantman.com/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.jasonantman.com/theme/css/pygments/default.css" rel="stylesheet">
        <link href="http://blog.jasonantman.com/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.jasonantman.com/theme/css/style.css" type="text/css"/>
        <link href="http://blog.jasonantman.com/theme/css/shariff/shariff.min.css" rel="stylesheet">

    <link rel="stylesheet" href="http://blog.jasonantman.com/theme/css/forkongithub.min.css" type="text/css" />

        <link href="http://blog.jasonantman.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Jason Antman's Blog ATOM Feed"/>

        <link href="http://blog.jasonantman.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Jason Antman's Blog RSS Feed"/>


        <link href="http://blog.jasonantman.com/feeds/categories/miscellaneous.atom.xml" type="application/atom+xml" rel="alternate"
              title="Jason Antman's Blog Miscellaneous ATOM Feed"/>

    <script src="https://widget.battleforthenet.com/widget.js" async></script>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
<span id="forkongithub"><a href="https://github.com/jantman/blog">Fork me on GitHub</a></span>        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.jasonantman.com/" class="navbar-brand">
Jason Antman's Blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="http://blog.jasonantman.com/pages/about.html">
                             About&nbsp;Me
                          </a></li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/ideas-and-rants/index.html">Ideas and rants</a>
                        </li>
                        <li class="active">
                            <a href="http://blog.jasonantman.com/categories/miscellaneous/index.html">Miscellaneous</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/monitoring/index.html">Monitoring</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/ops/index.html">Ops</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/projects/index.html">Projects</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/puppet/index.html">Puppet</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/tech-howtos/index.html">Tech howtos</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://blog.jasonantman.com/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.jasonantman.com/2009/06/daily-work-nagios-snmp-traps-vyatta-jasonantmancom-upgrades/"
                       rel="bookmark"
                       title="Permalink to Daily Work - Nagios SNMP traps, Vyatta, JasonAntman.com upgrades">
                        Daily Work - Nagios <span class="caps">SNMP</span> traps, Vyatta, JasonAntman.com&nbsp;upgrades
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2009-06-27T01:03:00-04:00"> Sat 27 June 2009</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="http://blog.jasonantman.com/tags/apc/index.html">apc</a>
        /
	<a href="http://blog.jasonantman.com/tags/bluesocket/index.html">bluesocket</a>
        /
	<a href="http://blog.jasonantman.com/tags/nagios/index.html">Nagios</a>
        /
	<a href="http://blog.jasonantman.com/tags/snmp/index.html">snmp</a>
        /
	<a href="http://blog.jasonantman.com/tags/vyatta/index.html">vyatta</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>So it&#8217;s been a very busy day. I was up until 5 <span class="caps">AM</span> or so working on
implementing <a href="http://reductivelabs.com/trac/puppet/">Puppet</a> at home.
I&#8217;m building two new boxes - a storage (centralized home
directory)/syslog (to MySQL) server and a second web server (possibly
also to handle Nagios) - and I decided that they&#8217;ll be totally built by
Puppet. The only thing I had to give up on was setting up the <span class="caps">NFS</span> share
for my home directory on the new storage box and installing and testing
<a href="http://www.rsyslog.com/">rsyslog</a> on&nbsp;it.</p>
<p>This afternoon around 7, I started on my weekend projects for <a href="http://www.midlandparkambulance.com">the
ambulance corps</a> - setting up
<a href="http://www.nagios.org">Nagios</a> to receive <span class="caps">SNMP</span> traps from the <span class="caps">APC</span> <span class="caps">UPS</span>
and moving over to the new <a href="http://www.vyatta.org">Vyatta</a>-based router
(from <a href="http://m0n0.ch/wall/">m0n0wall</a>). I&#8217;d attempted the router
before, but had to rollback - I&#8217;m using an old
<a href="http://www.bluesocket.com/">BlueSocket</a> controller for hardware - it&#8217;s
just a nice black 1U enclosure with a stock Intel motherboard, <span class="caps">20GB</span> <span class="caps">HDD</span>,
<span class="caps">512MB</span> <span class="caps">RAM</span> and three 10/100 NICs. The first time, I was unable to get
link on either of the two NICs I was using, so I decided to&nbsp;rollback.</p>
<p><strong>Nagios <span class="caps">SNMP</span>&nbsp;Traps</strong></p>
<p>I found a good starting point for Nagios <span class="caps">SNMP</span> traps on the <a href="http://altinity.blogs.com/dotorg/2006/03/lessons_in_snmp.html">OpsView
blog</a>. I
setup `snmptrapd` on the Nagios server and hacked together a little
Python script to just write all of the traps to a file. After some
testing with `snmptrap` on my laptop, I did a test by pulling the
power plug of the <span class="caps">UPS</span>, waiting about 30 seconds, and then plugging it
back in. Sure enough, the little old <a href="/2007/03/apc-ap9605-powernet-snmp-card/"><span class="caps">AP9605</span> PowerNet <span class="caps">SNMP</span>
card</a>
generated two <span class="caps">SNMP</span> traps - one for power loss and one for power regained
- both of which showed up in the test&nbsp;file</p>
<p>The next step will be deciding how to get the traps into Nagios -
specifically whether I want to go with something heavy-weight, like
<a href="http://snmptt.sourceforge.net/">SNMPtt</a> that can handle other devices,
or whether I want to code a simple script myself just to deal with the
<span class="caps">APC</span>&nbsp;cards.</p>
<p><strong>Router</strong></p>
<p>The main reason why I wanted to make the switch from m0n0 to Vyatta was
to ease the setup and maintenance of an IPsec tunnel from the ambulance
<span class="caps">HQ</span> to my house, so I could push backups (relatively small) over the <span class="caps">WAN</span>
to my infrastructure (or, rather, have Bacula pull the backups). Another
big bonus was finally having a way of configuring and checking things
through <span class="caps">SSH</span> without having to port-forward a web <span class="caps">GUI</span>. Another bonus of
having a real Linux system under the router is the ability to make
custom Nagios check scripts and easily execute them. Something I hadn&#8217;t
thought of - but became obvious during the switchover - is the ability
to run full-fledged `tcpdump` on the router&nbsp;itself.</p>
<p>After building the new config myself, and confirming that the system ran
in isolation, I moved it over to production. The first issue was a bit
of a thinko on my part - the interfaces on the <span class="caps">BSC</span> are actually arranged
on the back of the box like eth0&#8212;&#8212;-eth2&#8212;&#8212;-eth1, so I originally had
the <span class="caps">LAN</span> uplink in the wrong interface. After correcting that and waiting
for the network to stabilize, I noticed a total external connectivity
failure. After some troubleshooting - thanks to tcpdump on the router -
it occurred to me that the (ancient) cable modem needs to be rebooted
when the router <span class="caps">MAC</span>&nbsp;changes.</p>
<p>I honestly don&#8217;t remember the other problems that I ran into, but
eventually I ended up getting almost-full functionality - and then a
total network outage. A tcpdump on my laptop showed some really really
weird <span class="caps">BOOTP</span> traffic with addresses of 255.255.255.255. After doing some
troubleshooting and monitoring port counters on the switch, I narrowed
it down to coming from a single Windows box and the wireless access
point. After shutting off both ports, things seemed to stabilize. I also
had some &#8220;martian address&#8221; issues with one of the boxes, but decided to
roll the box and that solved&nbsp;it.</p>
<p>Over the next day or so, I&#8217;ll be reconfiguring Nagios both at home and
at the ambulance corps to cope with the changes and add in the requisite
monitoring, and keep an eye on things. Assuming all goes well, I&#8217;ll
power down the old router on&nbsp;Sunday.</p>
<p>On the home front, I&#8217;ve moved over from my old storage machine to the
old one - essentially just the <span class="caps">NFS</span> mount, and moved over a tarball of
everything else. I also added a 1000Base-<span class="caps">SX</span> card to the new box, though
it appears that I&#8217;m out of fiber patch cords. The old storage box was
brought down for the first time in about 3 years (aside from brief
outages for hardware upgrades or array rebuilds). Assuming I got
everything off of it, it will be relegated to the spares&nbsp;pile.</p>
<p>I&#8217;m going to make a serious effort to post on a daily basis, if only for
my own future reference. I should have the demo of
<a href="http://rackman.jasonantman.com">RackMan</a> out soon, and I&#8217;m also about
to start on integrating it with Nathan Hubbard&#8217;s
<a href="http://www.machdb.org/">MachDB</a> as well as a <span class="caps">PHP</span> script I wrote to pull
port names and MACs from Cisco switches and associate them with NICs in
machines. Hopefully I&#8217;ll also have some interesting Puppet stuff out&nbsp;soon.</p>
            </div>
            <!-- /.entry-content -->
    <hr />
    <!-- Shariff Button BEGIN -->
    <div class="shariff"
        data-lang="en"
        data-orientation="horizontal"
        data-services = "[&quot;facebook&quot;,&quot;googleplus&quot;,&quot;twitter&quot;,&quot;linkedin&quot;,&quot;diaspora&quot;]"
        data-theme="standard"
        data-url="http://blog.jasonantman.com/2009/06/daily-work-nagios-snmp-traps-vyatta-jasonantmancom-upgrades/"></div>
    <!-- Shariff Button END -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'jantman'; // required: replace example with your forum shortname

                    var disqus_identifier = 'daily-work-nagios-snmp-traps-vyatta-jasonantmancom-upgrades';
                var disqus_url = 'http://blog.jasonantman.com/2009/06/daily-work-nagios-snmp-traps-vyatta-jasonantmancom-upgrades/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Recent Posts -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
  <ul class="list-group" id="recentposts">
    <li class="list-group-item"><a href="http://blog.jasonantman.com/2017/10/cloud-custodian-architecture-deployment-and-policy-preprocessing/">Cloud Custodian Architecture, Deployment and Policy&nbsp;Preprocessing</a></li>
    <li class="list-group-item"><a href="http://blog.jasonantman.com/2017/10/pre-authorized-aws-console-urls-for-notifications/">Pre-Authorized <span class="caps">AWS</span> Console URLs for&nbsp;Notifications</a></li>
    <li class="list-group-item"><a href="http://blog.jasonantman.com/2017/04/python-script-to-check-xfinity-data-usage/">Python script to check xfinity data&nbsp;usage</a></li>
    <li class="list-group-item"><a href="http://blog.jasonantman.com/2017/03/vyos-on-alix-2c1-single-board-computer/">VyOS on Alix 2C1 Single Board&nbsp;Computer</a></li>
    <li class="list-group-item"><a href="http://blog.jasonantman.com/2016/10/yesterdays-widespread-internet-outage-for-non-geeks/">Yesterday&#8217;s Widespread Internet Outage, for&nbsp;non-geeks</a></li>
  </ul>
</li>
<!-- End Sidebar/Recent Posts -->

<!-- Sidebar/Twitter Timeline -->
<li class="list-group-item">
  <h4><i class="fa fa-twitter fa-lg"></i><span class="icon-label">Latest Tweets</span></h4>
  <div id="twitter_timeline">
    <a class="twitter-timeline" data-width="250" data-height="300" data-dnt="true" data-theme="light" href="https://twitter.com/j_antman">Tweets by j_antman</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</li>
<!-- End Sidebar/Twitter Timeline -->

<!-- Sidebar/Github -->
<li class="list-group-item">
  <h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
  <div id="gh_repos">
    <p class="list-group-item">Status updating...</p>
  </div>
  <a href="https://github.com/jantman">@jantman</a> on GitHub
</li>
<!-- End Sidebar/Github -->

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="http://www.jasonantman.com" target="_blank">Homepage</a>
    </li>
    <li class="list-group-item">
      <a href="http://resume.jasonantman.com" target="_blank">Resume</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2017 Jason Antman
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.jasonantman.com/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.jasonantman.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.jasonantman.com/theme/js/respond.min.js"></script>



    <!-- GITHUB_REPOS_JSON (explicitly pinned repos ) -->
  <script id="GithubReposJson" type="application/json">
  [{"description": "A script and python module to check your AWS service limits and usage via boto.", "name": "awslimitchecker", "html_url": "https://github.com/jantman/awslimitchecker"}, {"description": "Puppet module and accompanying documentation to install/setup Arch linux on a MacBook Pro Retina 11,4", "name": "puppet-archlinux-macbookretina", "html_url": "https://github.com/jantman/puppet-archlinux-macbookretina"}, {"description": "A collection of scripts that I've written", "name": "misc-scripts", "html_url": "https://github.com/jantman/misc-scripts"}, {"description": "Responsive Flask/SQLAlchemy personal finance app, specifically for biweekly budgeting.", "name": "biweeklybudget", "html_url": "https://github.com/jantman/biweeklybudget"}, {"description": "Calculate detailed download stats and generate HTML and badges for PyPI packages", "name": "pypi-download-stats", "html_url": "https://github.com/jantman/pypi-download-stats"}, {"description": "A standard to easily communicate to humans and machines the development/support and usability status of software repositories/projects.", "name": "repostatus.org", "html_url": "https://github.com/jantman/repostatus.org"}]
  </script>

<!-- GitHub JS Code -->
<script type="text/javascript">
$(document).ready(function () {
  if (!window.jXHR) {
    var jxhr = document.createElement('script');
    jxhr.type = 'text/javascript';
    jxhr.src = 'http://blog.jasonantman.com/theme/js/jXHR.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(jxhr, s);
  }

  console.log($('#GithubReposJson').html());
  github.showSpecificRepos({
    user: 'jantman',
    target: '#gh_repos',
    repos: JSON.parse($('#GithubReposJson').html())
  });
});
</script>
<script src="http://blog.jasonantman.com/theme/js/github.js" type="text/javascript"></script>
<!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'jantman'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics Universal -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-2718127-2', 'jasonantman.com');
        ga('send', 'pageview');
    </script>
    <!-- End Google Analytics Universal Code -->


    <!-- add shariff support -->
    <script src="http://blog.jasonantman.com/theme/js/shariff.min.js"></script>
</body>
</html>