<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Tooling for AWS - webhooks to SQS via API Gateway and Lambda - Jason Antman's Blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://blog.jasonantman.com/2016/08/tooling-for-aws-webhooks-to-sqs-via-api-gateway-and-lambda/">

        <meta name="author" content="Jason Antman" />
        <meta name="keywords" content="aws,webhook,lambda,github,api-gateway,sqs,queue,python,terraform" />
        <meta name="description" content="Project I created that uses Python and Terraform to setup an AWS API Gateway instance to receive webhooks, and enqueue their content in SQS queues via Lambda." />

        <meta property="og:site_name" content="Jason Antman's Blog" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Tooling for AWS - webhooks to SQS via API Gateway and Lambda"/>
        <meta property="og:url" content="https://blog.jasonantman.com/2016/08/tooling-for-aws-webhooks-to-sqs-via-api-gateway-and-lambda/"/>
        <meta property="og:description" content="Project I created that uses Python and Terraform to setup an AWS API Gateway instance to receive webhooks, and enqueue their content in SQS queues via Lambda."/>
        <meta property="article:published_time" content="2016-08-06" />
            <meta property="article:section" content="AWS" />
            <meta property="article:tag" content="aws" />
            <meta property="article:tag" content="webhook" />
            <meta property="article:tag" content="lambda" />
            <meta property="article:tag" content="github" />
            <meta property="article:tag" content="api-gateway" />
            <meta property="article:tag" content="sqs" />
            <meta property="article:tag" content="queue" />
            <meta property="article:tag" content="python" />
            <meta property="article:tag" content="terraform" />
            <meta property="article:author" content="Jason Antman" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://blog.jasonantman.com/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="https://blog.jasonantman.com/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://blog.jasonantman.com/theme/css/pygments/default.css" rel="stylesheet">
        <link href="https://blog.jasonantman.com/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="https://blog.jasonantman.com/theme/css/style.css" type="text/css"/>
        <link href="https://blog.jasonantman.com/theme/css/shariff/shariff.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://blog.jasonantman.com/theme/css/forkongithub.min.css" type="text/css" />

        <link href="https://blog.jasonantman.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Jason Antman's Blog ATOM Feed"/>

        <link href="https://blog.jasonantman.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Jason Antman's Blog RSS Feed"/>


        <link href="https://blog.jasonantman.com/feeds/categories/aws.atom.xml" type="application/atom+xml" rel="alternate"
              title="Jason Antman's Blog AWS ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
<span id="forkongithub"><a href="https://github.com/jantman/blog">Fork me on GitHub</a></span>        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://blog.jasonantman.com/" class="navbar-brand">
Jason Antman's Blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/pages/about.html">About Me</a></li>
                    <li><a href="/categories/aws/index.html">AWS</a></li>
                    <li><a href="/categories/software/index.html">Software</a></li>
                    <li><a href="/categories/hardware/index.html">Hardware</a></li>
                    <li><a href="/categories/diy-home-automation-security/index.html">DIY / Home Automation / Security</a></li>
                    <li><a href="/categories/miscellaneous/index.html">Miscellaneous</a></li>
                    <li><a href="/tags.html">Tags</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://blog.jasonantman.com/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://blog.jasonantman.com/2016/08/tooling-for-aws-webhooks-to-sqs-via-api-gateway-and-lambda/"
                       rel="bookmark"
                       title="Permalink to Tooling for AWS - webhooks to SQS via API Gateway and Lambda">
                        Tooling for <span class="caps">AWS</span> - webhooks to <span class="caps">SQS</span> via <span class="caps">API</span> Gateway and&nbsp;Lambda
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-08-06T21:38:00-04:00"> Sat 06 August 2016</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://blog.jasonantman.com/tags/aws/index.html">aws</a>
        /
	<a href="https://blog.jasonantman.com/tags/webhook/index.html">webhook</a>
        /
	<a href="https://blog.jasonantman.com/tags/lambda/index.html">lambda</a>
        /
	<a href="https://blog.jasonantman.com/tags/github/index.html">github</a>
        /
	<a href="https://blog.jasonantman.com/tags/api-gateway/index.html">api-gateway</a>
        /
	<a href="https://blog.jasonantman.com/tags/sqs/index.html">sqs</a>
        /
	<a href="https://blog.jasonantman.com/tags/queue/index.html">queue</a>
        /
	<a href="https://blog.jasonantman.com/tags/python/index.html">python</a>
        /
	<a href="https://blog.jasonantman.com/tags/terraform/index.html">terraform</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>A few weeks ago at work, I was party to two discussions about possible tooling needs, both very low-priority. One was the possible need to sync MarkDown documentation
from GitHub repositories to&#8230; another thing that can hold docs. The other was relating to the new Version 2 Docker Registry, <a href="https://github.com/docker/distribution">distribution</a>.
We have some Jenkins jobs that dynamically populate dropdown fields for build parameters with Docker image names and tags, using the <a href="https://wiki.jenkins-ci.org/display/JENKINS/Active+Choices+Plugin">Active Choices Plugin</a>.
Right now we&#8217;re directly querying the Docker Registry <span class="caps">API</span> from Groovy, every time the Build With Parameters page is loaded. With the original version 1 Docker Registry,
images were often missing from the results (eek!) but the performance was good. With the switch to the v2 Registry, it takes almost two minutes to load the page.
While brainstorming solutions, we decided that caching the list of images and tags in the Registry was the solution. For bonus points, it would also be nice to
be able to query based on image labels - something that&#8217;s not exposed in the Registry <span class="caps">API</span> at all. Luckily, the Registry has an option to fire a webhook every time
a new image is&nbsp;pushed.</p>
<p>Both of these problems have solutions that involve webhooks, from GitHub and Docker Distribution, respectively. They also both involve doing time-consuming things in custom code with the
data in those hooks - transforming MarkDown to another markup and pushing the result to an on-premesis system in the case of GitHub, and <code>pull</code>ing and inspecting Docker
images in the case of the Registry. As such, the &#8220;typical&#8221; webhook things like <a href="https://zapier.com/">Zapier</a> won&#8217;t fit the bill. All I really needed was something to receive webhooks
and push the content of them into a queue. Ideally, it would also be something that would utilize existing services we have, namely&nbsp;<span class="caps">AWS</span>.</p>
<p>After working a bunch of nights and the good part of a weekend, I have a solution: my new <a href="https://pypi.python.org/pypi/webhook2lambda2sqs">webhook2lambda2sqs</a> Python&nbsp;package.</p>
<p>This implements what I think is the cheapest and lowest-overhead solution for anyone with an existing <span class="caps">AWS</span>&nbsp;account:</p>
<ul>
<li>Setup an <a href="https://aws.amazon.com/api-gateway/"><span class="caps">API</span> Gateway</a> that receives json <span class="caps">POST</span> and <span class="caps">GET</span>&nbsp;requests.</li>
<li>It passes them to a <a href="https://aws.amazon.com/lambda/">Lambda Function</a> which pushes the content to one or more <a href="https://aws.amazon.com/sqs/"><span class="caps">SQS</span></a> queues, for consumption by an&nbsp;application.</li>
</ul>
<p>The tooling is written in Python, but leverages <a href="https://www.terraform.io/">HashiCorp&#8217;s Terraform</a> to actually manage the <span class="caps">AWS</span>&nbsp;resources.</p>
<p>From a <span class="caps">JSON</span> configuration file as simple&nbsp;as:</p>
<div class="highlight"><pre><span></span>{
  &quot;endpoints&quot;: {
    &quot;some_resource_name&quot;: {
      &quot;method&quot;: &quot;<span class="caps">POST</span>&quot;,
      &quot;queues&quot;: [&quot;myqueue&quot;]
    },
  },
}
</pre></div>


<p>and a single command (<code>webhook2lambda2sqs genapply</code>), you&#8217;ll have the complete system up and running, receiving <span class="caps">HTTP</span> <span class="caps">POST</span> requests
at an <span class="caps">AWS</span>-generated <span class="caps">URL</span> and pushing them into the <code>myqueue</code> <span class="caps">SQS</span> queue. Best of all, going by my testing (this is based on the time
the Lambda function takes to run, which can vary quite a bit), the whole thing is <strong>free for the first 1 million requests per month</strong>
if your account is still on the Free Tier, and otherwise is less than $4/month for the first million&nbsp;requests.</p>
<p>The configuration can handle setting up multiple distinct endpoint paths in the same <span class="caps">API</span> Gateway, each
sending the data to one or more <span class="caps">SQS</span> queues. It also has options for enabling logging (to CloudWatch Logs) both in the function
and on the <span class="caps">API</span> Gateway, pushing <span class="caps">API</span> Gateway metrics to CloudWatch, and configuring rate&nbsp;limiting.</p>
<p>The <code>webhook2lambda2sqs</code> program generates the Python code for the lambda function and packages it correctly for Lambda, and
then generates a Terraform configuration to manage all required <span class="caps">AWS</span> resources. Separate commands are available that wrap Terraform
(mainly to deal with some issues with its <span class="caps">API</span> Gateway implementation) to run <code>plan</code>, <code>apply</code> and <code>destroy</code>. There are
also helper commands to view the Lambda Function and <span class="caps">API</span> Gateway logs from CloudWatch, view messages in the queue(s) and
<span class="caps">GET</span> or <span class="caps">POST</span> a test message to one or all of the&nbsp;endpoints.</p>
<p>Full documentation is available at <a href="http://webhook2lambda2sqs.readthedocs.io/en/latest/">http://webhook2lambda2sqs.readthedocs.io/en/latest/</a>
and the package (Python 2.7, 3.3-3.5) can be downloaded <a href="https://pypi.python.org/pypi/webhook2lambda2sqs">from PyPI</a>.</p>
            </div>
            <!-- /.entry-content -->
    <hr />
    <!-- Shariff Button BEGIN -->
    <div class="shariff"
        data-lang="en"
        data-orientation="horizontal"
        data-services = "[&quot;facebook&quot;,&quot;googleplus&quot;,&quot;twitter&quot;,&quot;linkedin&quot;,&quot;diaspora&quot;]"
        data-theme="standard"
        data-url="https://blog.jasonantman.com/2016/08/tooling-for-aws-webhooks-to-sqs-via-api-gateway-and-lambda/"></div>
    <!-- Shariff Button END -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'jantman'; // required: replace example with your forum shortname

                    var disqus_identifier = 'tooling-for-aws-webhooks-to-sqs-via-api-gateway-and-lambda';
                var disqus_url = 'https://blog.jasonantman.com/2016/08/tooling-for-aws-webhooks-to-sqs-via-api-gateway-and-lambda/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Recent Posts -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
  <ul class="list-group" id="recentposts">
    <li class="list-group-item"><a href="https://blog.jasonantman.com/2021/03/octoprint-power-outage-handling/">OctoPrint Power Outage&nbsp;Handling</a></li>
    <li class="list-group-item"><a href="https://blog.jasonantman.com/2020/11/on-the-creation-use-and-management-of-docker-images/">On The Creation, Use, and Management of Docker&nbsp;Images</a></li>
    <li class="list-group-item"><a href="https://blog.jasonantman.com/2019/04/galaxy-s10--android-9-alarm-app-broken-by-battery-optimization/">Galaxy S10 / Android 9 alarm app broken by battery&nbsp;optimization</a></li>
    <li class="list-group-item"><a href="https://blog.jasonantman.com/2019/03/arch-linux-on-a-dell-precision-5530--xps-15-9570-laptop/">Arch Linux on a Dell Precision 5530 / <span class="caps">XPS</span> 15 9570&nbsp;Laptop</a></li>
    <li class="list-group-item"><a href="https://blog.jasonantman.com/2018/12/twilio-programmable-wireless-ppp-proxy-docker-image/">Twilio Programmable Wireless <span class="caps">PPP</span> Proxy Docker&nbsp;Image</a></li>
  </ul>
</li>
<!-- End Sidebar/Recent Posts -->

<!-- Sidebar/Twitter Timeline -->
<li class="list-group-item">
  <h4><i class="fa fa-twitter fa-lg"></i><span class="icon-label">Latest Tweets</span></h4>
  <div id="twitter_timeline">
    <a class="twitter-timeline" data-width="250" data-height="300" data-dnt="true" data-theme="light" href="https://twitter.com/j_antman">Tweets by j_antman</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</li>
<!-- End Sidebar/Twitter Timeline -->

<!-- Sidebar/Github -->
<li class="list-group-item">
  <h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
  <div id="gh_repos">
    <p class="list-group-item">Status updating...</p>
  </div>
  <a href="https://github.com/jantman">@jantman</a> on GitHub
</li>
<!-- End Sidebar/Github -->

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="http://www.jasonantman.com" target="_blank">Homepage</a>
    </li>
    <li class="list-group-item">
      <a href="http://resume.jasonantman.com" target="_blank">Resume</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2021 Jason Antman
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://blog.jasonantman.com/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://blog.jasonantman.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://blog.jasonantman.com/theme/js/respond.min.js"></script>



    <!-- GITHUB_REPOS_JSON (explicitly pinned repos ) -->
  <script id="GithubReposJson" type="application/json">
  [{"description": "A script and python package to check your AWS service limits and usage via boto3.", "name": "awslimitchecker", "html_url": "https://github.com/jantman/awslimitchecker"}, {"description": "A collection of my standalone scripts to small/quick for their own repos. All kinds of useful stuff.", "name": "misc-scripts", "html_url": "https://github.com/jantman/misc-scripts"}, {"description": "Responsive Flask/SQLAlchemy personal finance app, specifically for biweekly budgeting.", "name": "biweeklybudget", "html_url": "https://github.com/jantman/biweeklybudget"}, {"description": "A standard to easily communicate to humans and machines the development/support and usability status of software repositories/projects.", "name": "repostatus.org", "html_url": "https://github.com/jantman/repostatus.org"}, {"description": "home automation/security config/scripts/tooling - HomeAssistant, AppDaemon, ZoneMinder, etc.", "name": "home-automation-configs", "html_url": "https://github.com/jantman/home-automation-configs"}, {"description": "A Python application for Linux machines to perform WiFi site surveys and present the results as a heatmap overlayed on a floorplan", "name": "python-wifi-survey-heatmap", "html_url": "https://github.com/jantman/python-wifi-survey-heatmap"}]
  </script>

<!-- GitHub JS Code -->
<script type="text/javascript">
$(document).ready(function () {
  if (!window.jXHR) {
    var jxhr = document.createElement('script');
    jxhr.type = 'text/javascript';
    jxhr.src = 'https://blog.jasonantman.com/theme/js/jXHR.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(jxhr, s);
  }

  console.log($('#GithubReposJson').html());
  github.showSpecificRepos({
    user: 'jantman',
    target: '#gh_repos',
    repos: JSON.parse($('#GithubReposJson').html())
  });
});
</script>
<script src="https://blog.jasonantman.com/theme/js/github.js" type="text/javascript"></script>
<!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'jantman'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics Universal -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-2718127-2', 'jasonantman.com');
        ga('send', 'pageview');
    </script>
    <!-- End Google Analytics Universal Code -->


    <!-- add shariff support -->
    <script src="https://blog.jasonantman.com/theme/js/shariff.min.js"></script>
</body>
</html>